{% extends 'layout.html' %}

{% block title %}Profile{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="text-center mb-4">
        <h2>Profile Page</h2>
    </div>
    <div class="d-flex justify-content-center">
        <div class="card shadow-sm mb-4" style="width: 30rem;">
            <div class="card-body">
                {% if mode == 'view' %}
                <div class="text-center">
                    <h5 class="card-title">Hi {{ user['first_name'] }}!</h5>
                    <a href="{{ '#' if user_id !=
                        user['user_id'] else url_for('profile_image', user_id=user['user_id']) }}"
                       class="icon-link icon-link-hover">
                        <img src="{{ user['profile_image'] }}" class="card-img-top rounded-circle m-3"
                             alt="Profile Image" style="width: 150px; height: 150px; object-fit: cover;">
                    </a>
                </div>
                <form class="row g-3 needs-validation" action="{{ url_for('profile', user_id=user['user_id']) }}"
                      method="POST" novalidate>
                    <div class="form-floating col-md-6">
                        <input type="text" class="form-control" id="first_name" placeholder="First name"
                               name="first_name" value="{{ user['first_name'] }}" readonly required>
                        <label for="first_name">First name</label>
                    </div>
                    <div class="form-floating col-md-6">
                        <input type="text" class="form-control" id="last_name" placeholder="Last name" name="last_name"
                               value="{{ user['last_name'] }}" readonly required>
                        <label for="last_name">Last name</label>
                    </div>
                    <div class="form-floating col-md-12">
                        <input type="email" class="form-control" id="pmail" placeholder="email@example.com" name="email"
                               value="{{ user['email'] }}" readonly required>
                        <label for="pmail">Email</label>
                    </div>
                    <div class="form-floating col-md-6">
                        <input type="text" class="form-control" id="description" placeholder="Description" name="description"
                               value="{{ user['description'] }}" readonly
                               required>
                        <label for="description">Description</label>
                    </div>
                    <div class="form-floating col-md-6">
                        <input type="text" class="form-control" id="location" placeholder="Location" name="location"
                               value="{{ user['location'] }}" readonly required>
                        <label for="location">Location</label>
                    </div>
                    <div class="form-floating col-md-6">
                        <select class="form-select" id="role" aria-label="User Role" disabled>
                            {% for r in ['member', 'moderator', 'admin'] %}
                            <option value="{{ r }}" {% if user[
                            'role'] == r %}selected{% endif %}>{{ r.capitalize() }}</option>
                            {% endfor %}
                        </select>
                        <label for="role">Role</label>
                    </div>
                    <div class="form-floating col-md-6">
                        <select class="form-select" id="status" aria-label="User Status" disabled>
                            {% for s in ['active', 'inactive'] %}
                            <option value="{{ s }}" {% if user[
                            'status'] == s %}selected{% endif %}>{{ s.capitalize() }}</option>
                            {% endfor %}
                        </select>
                        <label for="status">Status</label>
                    </div>
                    <input type="hidden" id="pmode" name="pmode" value="edit">
                    <div class="d-grid gap-2 col-md-8 col-lg-6 mx-auto">
                        {% if user_id == user['user_id'] %}
                        <a href="{{ url_for('password', user_id=user['user_id']) }}" class="btn btn-outline-success">Update
                            Password</a>
                        {% endif %}
                        {% if user_id != user['user_id'] and role == 'admin' and user['status'] == 'active' %}
                        <button type="submit" class="btn btn-outline-success">Edit User</button>
                        {% else %}
                        <button type="submit" class="btn btn-outline-success">Edit Profile</button>
                        {% endif %}
                    </div>
                </form>
                {% else %}
                <div class="text-center">
                    <h5 class="card-title">Hi {{ user['first_name'] }}!</h5>
                    <img src="{{ user['profile_image'] }}" class="card-img-top rounded-circle m-3"
                         alt="Profile Image" style="width: 150px; height: 150px; object-fit: cover;">
                </div>
                <form class="row g-3 needs-validation" action="{{ url_for('profile', user_id=user['user_id']) }}"
                      method="POST" novalidate>
                    <div class="form-floating col-md-6">
                        <input type="text" class="form-control" id="first_name2" placeholder="First name"
                               name="first_name" value="{{ user['first_name'] }}" {{ 'readonly disabled' if user_id
                        !=
                        user['user_id'] or mode != 'edit' else '' }} required>
                        <label for="first_name2">First name</label>
                    </div>
                    <div class="form-floating col-md-6">
                        <input type="text" class="form-control" id="last_name2" placeholder="Last name" name="last_name"
                               value="{{ user['last_name'] }}" {{ 'readonly disabled' if user_id !=
                        user['user_id'] or mode
                        != 'edit' else '' }} required>
                        <label for="last_name2">Last name</label>
                    </div>
                    <div class="form-floating col-md-12">
                        <input type="email" class="form-control" id="pmail2" placeholder="email@example.com"
                               name="email" value="{{ user['email'] }}" {{ 'readonly disabled' if user_id !=
                        user['user_id'] or mode != 'edit' else '' }} required>
                        <label for="pmail2">Email</label>
                    </div>
                    <div class="form-floating col-md-6">
                        <input type="text" class="form-control" id="description2" placeholder="Description" name="description"
                               value="{{ user['description'] }}" {{ 'readonly
                        disabled' if user_id != user['user_id'] or
                        mode != 'edit' else '' }} required>
                        <label for="description2">Description</label>
                    </div>
                    <div class="form-floating col-md-6">
                        <input type="text" class="form-control" id="location2" placeholder="Location" name="location"
                               value="{{ user['location'] }}" {{ 'readonly disabled' if user_id != user['user_id']
                        or mode
                        != 'edit' else '' }} required>
                        <label for="location2">Location</label>
                    </div>
                    <div class="form-floating col-md-6">
                        <select class="form-select" id="role2" aria-label="User Role" name="role" {{ 'disabled' if role
                        != 'admin' and user['status'] != 'active' }}>
                        {% for r in ['member', 'moderator', 'admin'] %}
                        <option value="{{ r }}" {% if user[
                        'role'] == r %}selected{% endif %}>{{ r.capitalize() }}</option>
                        {% endfor %}
                        </select>
                        <label for="role2">Role</label>
                    </div>
                    <div class="form-floating col-md-6">
                        <select class="form-select" id="status2" aria-label="User Status" name="status" {{ 'disabled' if
                        role != 'admin' and user['status'] != 'active' }}>
                        {% for s in ['active', 'inactive'] %}
                        <option value="{{ s }}" {% if user[
                        'status'] == s %}selected{% endif %}>{{ s.capitalize() }}</option>
                        {% endfor %}
                        </select>
                        <label for="status2">Status</label>
                    </div>
                    <input type="hidden" id="pmode2" name="pmode" value="submit">
                    <div class="d-grid gap-2 col-md-8 col-lg-6 mx-auto">
                        <button type="submit" class="btn btn-success">Save Changes</button>
                    </div>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
