{% extends 'layout.html' %}

{% block title %}Competitions Mgmt{% endblock %}

{% block content %}
<div>
    <!-- Competitions Section -->
    <a href="{{ url_for('competition_create') }}" class="btn btn-outline-success" role="button">Create a Competition</a>
    <div class="competitions">
        <div>
            {% for competition in competitions %}
            <div class="competition-card">
                <div class="card h-100 border-0 shadow-sm text-white position-relative"
                     style="background: url('{{ competition.image or '/static/images/default_competition.png' }}') no-repeat center center / cover;">
                    <div class="card-body d-flex flex-column justify-content-between p-4 bg-opacity-50 position-relative">
                        <div>
                            <h5 class="card-title">{{ competition.name }}</h5>
                            <p class="card-text">{{ competition.status }}</p>
                        </div>
                        <div class="text-end position-absolute bottom-0 end-0 m-3 d-flex">
                            {% if competition.status == 'in_plan' %}
                            <a href="{{ url_for('competition_edit', competition_id=competition.competition_id) }}"
                               class="link-light text-decoration-none me-3">Edit</a>
                            <a href="{{ url_for('competitors_manage', competition_id=competition.competition_id) }}"
                               class="link-light text-decoration-none me-3">Manage Competitors</a>
                            <form action="{{ url_for('competition_delete', competition_id=competition.competition_id) }}"
                               method="POST" class="">
                             <button type="button" class="btn btn-outline-danger btn-sm delete-btn"
                                     data-bs-toggle="modal"
                                     data-bs-target="#confirmDeleteModal"
                                     data-item-id="{{ competition.competition_id }}"
                                     data-item-type="competition">
                                 <i class="bi bi-backspace"></i>
                                 <span class="delete-text">Delete</span>
                             </button>
                         </form>
                         {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this item?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
            </div>
        </div>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        var confirmDeleteModal = document.getElementById('confirmDeleteModal');
        var confirmDeleteButton = document.getElementById('confirmDeleteButton');
        var formToSubmit;

        confirmDeleteModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            formToSubmit = button.closest('form');
        });

        confirmDeleteButton.addEventListener('click', function () {
            formToSubmit.submit();
            var modal = bootstrap.Modal.getInstance(confirmDeleteModal);
            modal.hide();
        });
    });
</script>
{% endblock %}